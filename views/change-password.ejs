<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Change</title>

    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhai+2:wght@600&family=Overpass:wght@300&family=Roboto+Mono:wght@300&family=Source+Sans+Pro:wght@200&family=Ubuntu&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/change-password.css">
    <!-- Icon libraray -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <!-- HEADER -->
    <header id="header">
        <div class="logo">
            <img src="https://www.cdac.in/index.aspx?id=img_cdac-logo">
        </div>
        <span class="right font2">Branch : Cine, Silchar</span>
    </header>


    <!-- NAVIGATION BAR -->
    <nav id="navbar">
        <div id="navbar-items">
            <ul>
                <li class="item"><a href="#" class="active">Home</a></li>
                <li class="item"><a href="#">About us</a></li>
                <li class="item dropdown"><a href="#">Adminstration</a>
                    <div class="dropdown-content">
                        <a href="#">Link 1</a>
                        <a href="#">Link 2</a>
                        <a href="#">Link 3</a>
                    </div>
                </li>
                <li class="item"><a href="#">Internships</a></li>
                <li class="item dropdown"><a href="#">Important Links</a>
                    <div class="dropdown-content">
                        <a href="#">Link 1</a>
                        <a href="#">Link 2</a>
                        <a href="#">Link 3</a>
                    </div>
                </li>
                <li class="item"><a href="#">Contact Us</a></li>
            </ul>
        </div>
        <div id="navbar-right">

            <form class="search-bar" role="search">
                <input class="form-control font2" type="search" placeholder="Search.." aria-label="Search">
                <button class="btn-primary font2" type="submit"><i class="fa fa-search"></i></button>
            </form>
        </div>
    </nav>


    <div class="container">
      <% if(currentUser) { %>
        <aside id="aside">
            <ul class="aside-list">
                <li class="aside-item"><a href="/dash_index" class="font6"><div>View/ Update Profile</div></a></li>
                <li class="aside-item active"><a href="/courses" class="font6"><div>Courses</div></a></li>
                <% if(currentUser.usertype == "faculty") { %>
                  <li class="aside-item"><a href="/course-upload" class="font6"><div>Add a course</div></a></li>
                <% } %>
                <li class="aside-item"><a href="/enrolled_course" class="font6"><div>Courses Enrolled</div></a></li>
                <li class="aside-item"><a href="#" class="font6"><div>Upload your Institute ID Card</div></a></li>
                <li class="aside-item"><a href="#" class="font6"><div>Download Certificate</div></a></li>
                <li class="aside-item"><a href="/change-password" class="font6"><div>Change Password</div></a></li>
            </ul>
        </aside>
      <% } %>


        <section id="course-section">
            <div class="section-bar">
                <strong class="font3">Welcome <%=currentUser.username %></strong>
                <div class="logout"><button class="btn-secondary logout-btn">Logout</button></div>
            </div>
            <div>
              <div class="mainDiv">
                <div class="cardStyle">
                  <form action="/change-password" method="POST" name="signupForm" id="signupForm">

                    <img src="" id="signupLogo"/>

                    <h2 class="formTitle">
                      Change password of your account
                    </h2>
                    <div class="inputDiv" style="display: none;">
                      <label class="inputLabel" for="password">Username</label>
                      <input type="password" id="password" name="username" value="<%= currentUser.username %>" required>
                    </div>
                    <div class="inputDiv">
                      <label class="inputLabel" for="password">Old Password</label>
                      <input type="password" id="password" name="oldPassword" required>
                    </div>
                  <div class="inputDiv">
                    <label class="inputLabel" for="password">New Password</label>
                    <input type="password" id="password" name="password" required>
                  </div>

                  <div class="inputDiv">
                    <label class="inputLabel" for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" name="password1">
                  </div>
                  <div class="captcha">
                    <div class="preview"></div>
                    <input type="text" name="captcha" value="" id="captcha-value" style="display: none;">
                    <div class ="input captcha-form">
                      <input type="text" placeholder="Enter captcha" name="inputCaptcha" id="captcha-form" />
                      <button class="captcha-refresh">
                             <i class="fa fa-refresh" ></i>
                      </button>
                    </div>
                  </div>

                  <div class="buttonWrapper">
                    <button type="submit" id="submitButton" class="submitButton pure-button pure-button-primary">
                      <span>Submit</span>
                      <span id="loader"></span>
                    </button>
                  </div>

                </form>
                </div>
              </div>



            <script>
                var password = document.getElementById("password")
                , confirm_password = document.getElementById("confirmPassword");

              document.getElementById('signupLogo').src = "https://media.9curry.com/uploads/organization/image/3157/cdac-silchar-logo.png";
              enableSubmitButton();

              function validatePassword() {
                // if(password.value != confirm_password.value) {
                //   confirm_password.setCustomValidity("Passwords Don't Match");
                //   return false;
                // } else {
                //   confirm_password.setCustomValidity('');
                  return true;
                // }
              }

              password.onchange = validatePassword;
              confirm_password.onkeyup = validatePassword;

              function enableSubmitButton() {
                document.getElementById('submitButton').disabled = false;
                document.getElementById('loader').style.display = 'none';
              }

              function disableSubmitButton() {
                document.getElementById('submitButton').disabled = true;
                document.getElementById('loader').style.display = 'unset';
              }

              function validateSignupForm() {
                var form = document.getElementById('signupForm');

                for(var i=0; i < form.elements.length; i++){
                    if(form.elements[i].value === '' && form.elements[i].hasAttribute('required')){
                      console.log('There are some required fields!');
                      return false;
                    }
                  }

                if (!validatePassword()) {
                  return false;
                }

                onSignup();
              }

              function onSignup() {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {

                  disableSubmitButton();

                  if (this.readyState == 4 && this.status == 200) {
                    enableSubmitButton();
                  }
                  else {
                    console.log('AJAX call failed!');
                    setTimeout(function(){
                      enableSubmitButton();
                    }, 1000);
                  }

                };

                xhttp.open("GET", "ajax_info.txt", true);
                xhttp.send();
              }


              (function(){
                const fonts = ["cursive", "sans-serif", "serif", "monospace"];
                let captchaValue = "";

                function generateCaptcha(){
                let value = btoa(Math.random()*1000000000);
                value = value.substring(0,5+Math.random()*5);
                captchaValue = value;
                }

                function setCaptcha(){
                    let html =captchaValue.split("").map((char)=>{
                        const rotate = -20 + Math.trunc(Math.random()*30);
                        const font = Math.trunc(Math.random()*fonts.length);
                        return `<span
                           style="
                             transform:rotate(${rotate}deg);
                             font-family:${fonts [font]}
                            "
                        >${char}</span>`;
                    }).join("");
                    document.querySelector(".mainDiv .cardStyle .captcha .preview").innerHTML = html;
                    document.getElementById('captcha-value').value = captchaValue;
                }

                function initCaptcha(){
                    document.querySelector(".mainDiv .cardStyle .captcha .captcha-refresh").addEventListener("click", function(){
                        generateCaptcha();
                        setCaptcha();
                      });
                      generateCaptcha();
                      setCaptcha();
                    }

                    initCaptcha();

                    document.querySelector(".mainDiv .cardStyle .input #input--submit").addEventListener("click", function(){
                        let inputCaptchaValue = document.querySelector(".mainDiv .cardStyle .captcha .captcha-form input").value;
                        if(inputCaptchaValue === captchaValue) {
                             swal("", "Logging In!", "success");
                        } else {
                            swal("Invalid captcha");
                        }
                     });

            })();


            </script>

                  <style>
                    /*captcha*/
                    .mainDiv .cardStyle .captcha{
                      padding-top: 19px;
                      padding-left: 73px;
                    }
                    .mainDiv .cardStyle .captcha .preview{
                      color: rgb(16, 15, 15);
                      width: 83%;
                      text-align: center;
                      height: 40px;
                      line-height: 40px;
                      letter-spacing: 16px;
                      border-radius: 4px;
                      border: none;
                      border: solid 1px #ccc;
                      padding: 0 11px;
                      background-color: rgba(255, 255, 255, 0.9);
                      font-family: "monospace";
                   }
                   .mainDiv .cardStyle .captcha .preview span{
                    display: inline-block;
                    user-select: none;
                  }
                  .mainDiv .cardStyle .captcha .captcha-form{
                    width: 100%;
                    display: flex;
                    padding-top: 19px;

                  }
                  .mainDiv .cardStyle .captcha .captcha-form input{
                    width: 70%;
                    font-size: 90%;
                    border-radius: 4px;
                    border: none;
                    border: solid 1px #ccc;
                    padding: 0 11px;
                  }
                  .mainDiv .cardStyle .captcha .captcha-form .captcha-refresh{
                    width:60px;
                    height: 40px;
                    border: none;
                    outline: none;
                    border-radius: 4px;
                    border: none;
                    padding: 0 11px;
                    background: rgb(166, 165, 165);

                    cursor: pointer;
                  }

                    .hidden_clip {
                      clip: rect(1px 1px 1px 1px);
                      clip: rect(1px, 1px, 1px, 1px);
                      position: absolute;
                    }

                    .form__field__wrapper {
                      position: relative;
                    }
                    .show-hide-password {
                      background: 0;
                      border: 0;
                      cursor: pointer;
                      min-height: 60px;
                      min-width: 70px;
                      padding: 18px;
                      position: absolute;
                      right: 0;
                      top: 14px;
                    }

                    .mainDiv {
                        display: flex;
                        min-height: 100%;
                        align-items: center;
                        justify-content: center;
                        background-color: #f9f9f9;
                        font-family: 'Open Sans', sans-serif;
                      }
                     .cardStyle {
                        width: 500px;
                        border-color: white;
                        background: #fff;
                        padding: 36px 0;
                        border-radius: 4px;
                        margin: 30px 0;
                        box-shadow: 0px 0 2px 0 rgba(0,0,0,0.25);
                      }
                    #signupLogo {
                      max-height: 100px;
                      margin: auto;
                      display: flex;
                      flex-direction: column;
                    }
                    .formTitle{
                      font-weight: 600;
                      margin-top: 20px;
                      color: #2F2D3B;
                      text-align: center;
                    }
                    .inputLabel {
                      font-size: 12px;
                      color: #555;
                      margin-bottom: 6px;
                      margin-top: 24px;
                    }
                      .inputDiv {
                        width: 70%;
                        display: flex;
                        flex-direction: column;
                        margin: auto;
                      }
                    input {
                      height: 40px;
                      font-size: 16px;
                      border-radius: 4px;
                      border: none;
                      border: solid 1px #ccc;
                      padding: 0 11px;
                    }
                    input:disabled {
                      cursor: not-allowed;
                      border: solid 1px #eee;
                    }
                    .buttonWrapper {
                      margin-top: 40px;
                    }
                      .submitButton {
                        width: 70%;
                        height: 40px;
                        margin: auto;
                        display: block;
                        color: #fff;
                        background-color: #065492;
                        border-color: #065492;
                        text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.12);
                        box-shadow: 0 2px 0 rgba(0, 0, 0, 0.035);
                        border-radius: 4px;
                        font-size: 14px;
                        cursor: pointer;
                      }
                    .submitButton:disabled,
                    button[disabled] {
                      border: 1px solid #cccccc;
                      background-color: #cccccc;
                      color: #666666;
                    }

                    #loader {
                      position: absolute;
                      z-index: 1;
                      margin: -2px 0 0 10px;
                      border: 4px solid #f3f3f3;
                      border-radius: 50%;
                      border-top: 4px solid #666666;
                      width: 14px;
                      height: 14px;
                      -webkit-animation: spin 2s linear infinite;
                      animation: spin 2s linear infinite;
                    }

                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                  </style>
            </div>
        </section>
    </div>


    <!-- FOOTER -->
    <footer id="footer">
        <div class="contact-logo">
            <a href="#" class="fa fa-facebook"></a>
            <a href="#" class="fa fa-linkedin"></a>
            <a href="#" class="fa fa-twitter"></a>
            <a href="#" class="fa fa-instagram"></a>
        </div>
        <div class="other-links">
            <p class="presskit-links font1">
                <a href="#" class="copyrights font1">Website Policies</a>
                <span class="copyrights">|</span>
                <a href="#" class="copyrights font1">Copyright Policy</a>
                <span class="copyrights">|</span>
                <a href="#" class="copyrights font1">Terms &amp; Conditions </a>
                <span class="copyrights">|</span>
                <a href="#" class="copyrights font1">Help</a>
                <span class="copyrights font1">|</span>
                <span class="copyrights font1">© 2022</span>
                <span class="copyrights font1"> C-DAC. All rights reserved</span>
                <span class="copyrights font1">|</span>
                <span id="LastUpdated" class="copyrights font1">Last Updated: Tuesday,&nbsp; June 07, 2022</span>
                <br>
                Website owned &amp; maintained by: Centre for Development of Advanced Computing (C-DAC)
            </p>
        </div>
    </footer>

</body>

</html>
